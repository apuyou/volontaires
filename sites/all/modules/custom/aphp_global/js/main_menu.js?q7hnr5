(function ($) {
  "use strict";

  // Swap between main menu elements.
  $(document).on('click', '.aphp-global-main-menu-first-level > .menu > li, .pane-aphp-global-aphp-main-menu-quick-select > .menu > li', function () {
    var i = $(this).index();

    // Display the correct main menu panel.
    $('.aphp-global-main-menu-second-level > div').each(function () {
      if ($(this).index() === i) {
        $(this).show();
      }
      else {
        $(this).hide();
      }
    });

    // Manage the first level elements display.
    $('.aphp-global-main-menu-first-level > .menu > li').each(function () {
      if ($(this).index() === i) {
        $(this).addClass('active-trail');
      }
      else {
        $(this).removeClass('active-trail');
      }
    });

    menuOpen()
  });

  // At page opening, make the correct element displayed.
  $(document).ready(function () {
    var $active = $('.aphp-global-main-menu-first-level li.active-trail');
    var i = 0;
    if ($active.length > 0) {
      i = $active.index();
    }
    $('.aphp-global-main-menu-second-level > div:eq(' + i + ')').show();
    $('.aphp-global-main-menu-first-level li:eq(' + i + ')').addClass('active-trail');
  });

  // Close the main menu when clicking outside.
  $(document).on('click', function (e) {
    var inMainMenu = $(e.target).parents('.pane-aphp-global-aphp-main-menu-render').length > 0;
    var inQuickMenu = $(e.target).parents('.pane-aphp-global-aphp-main-menu-quick-select').length > 0;
    var inButton = $(e.target).parents('.aphp-global-main-menu-button-container').length > 0 || $(e.target).hasClass('aphp-global-main-menu-button-container');

    if (inMainMenu || inQuickMenu || inButton) {
      return;
    }

    menuClose();
  });

  $(document).on('click', '.aphp-global-main-menu-button-container', function () {
    $(this).hasClass('open') ? menuClose() : menuOpen();
  });

  function menuOpen() {
    $('.pane-aphp-global-aphp-main-menu-quick-select').hide();
    $('.pane-aphp-global-aphp-main-menu-render').slideDown(150);
    $('.aphp-global-main-menu-button-container').addClass('open');
  }

  function menuClose() {
    $('.pane-aphp-global-aphp-main-menu-quick-select').show();
    $('.pane-aphp-global-aphp-main-menu-render').slideUp(150);
    $('.aphp-global-main-menu-button-container').removeClass('open');
  }
})(jQuery);
